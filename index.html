<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Schematic Inspector Pro</title>

    <link rel="icon" type="image/svg+xml" href="icons/logo.svg?v=4">
    <meta name="description" content="A web gui for viewing Vintage Story schematics.">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png?v=4">
    <meta name="apple-mobile-web-app-title" content="VSSchematicPreview">
    <meta name="author" content="James Woolley"> 
    <meta property="article:published_time" content="2026-01-11T20:50:00Z">
    <meta property="article:modified_time" content="2026-01-11T20:50:00Z">
    <meta name="DC.date.issued" content="2026-01-11">
    <link rel="canonical" href="https://jgwoolley.github.io/vintage-story-schematic-preview/">
    <meta name="theme-color" content="#2ea44f">

    <meta property="og:title" content="Nf3t VSSchematicPreview">
    <meta property="og:site_name" content="Nf3t VSSchematicPreview">
    <meta property="og:description" content="A web gui for viewing Vintage Story schematics.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://jgwoolley.github.io/vintage-story-schematic-preview/icons/og-image.png?v=4">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://jgwoolley.github.io/vintage-story-schematic-preview/?v=4">
    <meta property="og:article:author" content="James Woolley">

    <meta property="twitter:title" content="Nf3t VSSchematicPreview">
    <meta property="twitter:description" content="A web gui for viewing Vintage Story schematics.">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://jgwoolley.github.io/vintage-story-schematic-preview/?v=4">
    <meta property="twitter:title" content="Nf3t VSSchematicPreview">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Nf3t VSLauncher",
      "operatingSystem": "Windows, macOS, Linux",
      "applicationCategory": "GameApplication",
      "datePublished": "2026-01-11"
    }
    </script><meta property="twitter:image" content="https://jgwoolley.github.io/vintage-story-schematic-preview/icons/og-image.png?v=4">
    

    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; }
        
        /* Main UI Panel */
        #ui { position: absolute; top: 20px; left: 20px; z-index: 10; color: white; background: rgba(0, 0, 0, 0.95); padding: 20px; border-radius: 12px; width: 320px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); display: flex; flex-direction: column; max-height: 90vh; border: 1px solid #444; }
        
        /* Help & Inspector Panels */
        #inspector, #helpPanel { position: absolute; top: 20px; right: 20px; z-index: 11; color: white; background: rgba(0, 0, 0, 0.95); padding: 20px; border-radius: 12px; width: 280px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); display: none; border-left: 4px solid #0078d4; }
        
        .control-block { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        
        /* Search Bar with X Button */
        .search-container { position: relative; display: flex; align-items: center; }
        input[type="text"] { width: 100%; background: #222; border: 1px solid #444; color: white; padding: 10px 35px 10px 10px; border-radius: 6px; outline: none; font-size: 13px; }
        input[type="text"]:focus { border-color: #0078d4; }
        .clear-search { position: absolute; right: 10px; cursor: pointer; color: #888; font-weight: bold; font-size: 16px; user-select: none; }
        .clear-search:hover { color: white; }

        /* Sliders and Buttons */
        input[type="range"] { width: 100%; margin-top: 10px; accent-color: #0078d4; }
        .button-group { display: flex; gap: 8px; margin: 12px 0; }
        button { flex: 1; background: #333; color: #eee; border: 1px solid #444; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        button:hover { background: #444; border-color: #666; }
        button.help-btn { background: #0078d4; border: none; margin-bottom: 10px; }
        
        /* Legend List */
        #legend { overflow-y: auto; flex-grow: 1; margin-top: 10px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 13px; cursor: pointer; padding: 8px; border-radius: 6px; background: rgba(255, 255, 255, 0.03); border: 1px solid transparent; }
        .legend-item:hover { background: rgba(255, 255, 255, 0.08); border-color: #555; }
        .legend-item.hidden-block { opacity: 0.2; filter: grayscale(1); }
        .color-box { width: 14px; height: 14px; border-radius: 3px; margin-right: 12px; flex-shrink: 0; }
        .block-info { display: flex; justify-content: space-between; width: 100%; align-items: center; }
        .block-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 170px; color: #ccc; }
        .block-count { font-family: monospace; background: #222; padding: 2px 6px; border-radius: 4px; font-size: 11px; color: #aaa; }

        /* Typography */
        h3 { margin: 0 0 10px 0; font-size: 16px; color: #0078d4; }
        p, li { font-size: 12px; color: #bbb; line-height: 1.5; margin-bottom: 8px; }
        .trait { margin-top: 10px; font-size: 12px; color: #aaa; }
        .trait b { color: #fff; }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>
</head>

<body>
    <div id="ui">
        <button class="help-btn" onclick="toggleHelp()">Guide</button>
        <strong style="font-size: 1.2em; margin-bottom: 10px;">Schematic Inspector</strong>
        
        <input type="file" id="fileInput" accept=".json,.hjson" style="font-size: 11px; margin-bottom: 15px;">
        
        <div class="control-block">
            <div style="display:flex; justify-content: space-between; font-size: 12px;">
                <span>Layer (Y-Axis):</span>
                <span id="layerLabel" style="color: #0078d4; font-weight: bold;">All Floors</span>
            </div>
            <input type="range" id="layerSlider" min="-1" max="0" value="-1">
        </div>

        <div class="control-block">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Find block in list...">
                <span class="clear-search" id="clearSearch">×</span>
            </div>
        </div>

        <div class="button-group">
            <button onclick="toggleAll(true)">Show All</button>
            <button onclick="toggleAll(false)">Hide All</button>
        </div>
        <div id="legend"></div>
    </div>

    <div id="helpPanel">
        <h3>Instructions</h3>
        <ul style="padding-left: 15px;">
            <li><b>Rotate:</b> Left Click + Drag</li>
            <li><b>Pan:</b> Right Click + Drag</li>
            <li><b>Zoom:</b> Mouse Wheel</li>
            <li><b>Inspect:</b> Click any block to see its specific traits.</li>
            <li><b>Filter:</b> Click blocks in the list to toggle visibility.</li>
            <li><b>Layers:</b> Use the slider to view the build floor-by-floor.</li>
            <li><b>Search:</b> Filters the list to find specific materials.</li>
            <li><b><a href="https://github.com/jgwoolley/vintage-story-schematic-preview/" target="_blank" rel="noopener noreferrer" >Source Link</a></b></li>
        </ul>
        <button style="width: 100%;" onclick="toggleHelp()">Close Guide</button>
    </div>

    <div id="inspector">
        <h3>Block Traits</h3>
        <div id="traitContent"></div>
        <button style="width: 100%; margin-top: 15px;" onclick="closeInspector()">Close</button>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js';

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const light = new THREE.PointLight(0xffffff, 0.5);
        camera.add(light);
        scene.add(camera);

        let blockGroup = new THREE.Group();
        scene.add(blockGroup);
        let blockMetadata = new Map();
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let selectedBlock = null;
        let currentLayer = -1;
        let searchQuery = "";

        const defaultData = {"GameVersion":"1.21.6","SizeX":9,"SizeY":9,"SizeZ":1,"BlockCodes":{"3286":"game:metalblock-new-plain-gold","3267":"game:metalblock-new-plain-blackbronze"},"Indices":[3145728,4194304,5242880,1048577,2097153,3145729,4194305,5242881,6291457,7340033,1048578,2097154,3145730,4194306,5242882,6291458,7340034,3,1048579,2097155,3145731,4194307,5242883,6291459,7340035,8388611,4,1048580,2097156,3145732,4194308,5242884,6291460,7340036,8388612,5,1048581,2097157,3145733,4194309,5242885,6291461,7340037,8388613,1048582,2097158,3145734,4194310,5242886,6291462,7340038,1048583,2097159,3145735,4194311,5242887,6291463,7340039,3145736,4194312,5242888],"BlockIds":[3286,3286,3286,3286,3286,3286,3286,3286,3286,3286,3286,3267,3286,3286,3267,3286,3286,3286,3267,3286,3286,3286,3286,3286,3286,3286,3286,3267,3286,3286,3286,3286,3286,3286,3286,3286,3267,3286,3286,3286,3286,3286,3286,3286,3286,3267,3286,3286,3267,3286,3286,3286,3286,3286,3286,3286,3286,3286,3286,3286,3286]};
        let currentSchematicData = defaultData;

        // UI Globals
        window.toggleHelp = () => {
            const panel = document.getElementById('helpPanel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        };

        window.closeInspector = () => {
            document.getElementById('inspector').style.display = 'none';
            if (selectedBlock) {
                selectedBlock.material.emissive.setHex(0x000000);
                selectedBlock = null;
            }
        };

        // File/Input Handlers
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => { render(JSON.parse(ev.target.result)); };
            reader.readAsText(file);
        });

        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            updateLegendUI();
        });

        document.getElementById('clearSearch').addEventListener('click', () => {
            searchInput.value = "";
            searchQuery = "";
            updateLegendUI();
        });

        document.getElementById('layerSlider').addEventListener('input', (e) => {
            currentLayer = parseInt(e.target.value);
            document.getElementById('layerLabel').innerText = currentLayer === -1 ? "All Floors" : `Floor Y: ${currentLayer}`;
            applyAllFilters();
        });

        // Click to Inspect
        window.addEventListener('click', (event) => {
            if (event.target.closest('#ui') || event.target.closest('#inspector') || event.target.closest('#helpPanel')) return;
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const visibleBlocks = blockGroup.children.filter(obj => obj.visible);
            const intersects = raycaster.intersectObjects(visibleBlocks);
            
            if (selectedBlock) selectedBlock.material.emissive.setHex(0x000000);
            
            if (intersects.length > 0) {
                selectedBlock = intersects[0].object;
                selectedBlock.material.emissive.setHex(0x00ffff);
                showInspector(selectedBlock.userData);
            } else { closeInspector(); }
        });

        function showInspector(traits) {
            const panel = document.getElementById('inspector');
            const content = document.getElementById('traitContent');
            const entityData = currentSchematicData.BlockEntities && currentSchematicData.BlockEntities[traits.packedIndex];
            panel.style.display = 'block';
            content.innerHTML = `
                <div class="trait"><b>Code:</b><br>${traits.blockCode}</div>
                <div class="trait"><b>Position:</b><br>X:${traits.x}, Y:${traits.y}, Z:${traits.z}</div>
                <div class="trait"><b>Has Entity Data:</b> ${entityData ? "✅ Yes" : "❌ No"}</div>
            `;
        }

        function render(data) {
            blockGroup.clear();
            blockMetadata.clear();
            currentSchematicData = data;
            
            const slider = document.getElementById('layerSlider');
            slider.max = data.SizeY - 1;
            slider.value = -1;
            currentLayer = -1;
            document.getElementById('layerLabel').innerText = "All Floors";

            const geometry = new THREE.BoxGeometry(0.92, 0.92, 0.92);

            data.BlockIds.forEach((id) => {
                const code = data.BlockCodes[id] || "unknown";
                if (!blockMetadata.has(code)) {
                    blockMetadata.set(code, { color: stringToColor(code), visible: true, count: 0 });
                }
                blockMetadata.get(code).count++;
            });

            data.Indices.forEach((packedIndex, i) => {
                const x = packedIndex & 0x3FF;
                const z = (packedIndex >> 10) & 0x3FF;
                const y = (packedIndex >> 20) & 0x3FF;
                const code = data.BlockCodes[data.BlockIds[i]];
                const material = new THREE.MeshLambertMaterial({ color: blockMetadata.get(code).color });
                const cube = new THREE.Mesh(geometry, material);
                cube.position.set(x - data.SizeX / 2, y, z - data.SizeZ / 2);
                cube.userData = { blockCode: code, x, y, z, packedIndex };
                blockGroup.add(cube);
            });

            updateLegendUI();
            camera.position.set(data.SizeX * 1.5, data.SizeY + 10, data.SizeZ * 1.5);
            controls.target.set(0, data.SizeY / 2, 0);
            controls.update();
        }

        function applyAllFilters() {
            blockGroup.children.forEach(mesh => {
                const typeVisible = blockMetadata.get(mesh.userData.blockCode).visible;
                const layerVisible = (currentLayer === -1 || mesh.userData.y === currentLayer);
                mesh.visible = typeVisible && layerVisible;
            });
        }

        function updateLegendUI() {
            const container = document.getElementById('legend');
            container.innerHTML = '';
            const sortedEntries = [...blockMetadata.entries()]
                .filter(([code]) => code.toLowerCase().includes(searchQuery))
                .sort((a, b) => b[1].count - a[1].count);

            sortedEntries.forEach(([code, data]) => {
                const item = document.createElement('div');
                item.className = `legend-item ${data.visible ? '' : 'hidden-block'}`;
                item.onclick = () => {
                    data.visible = !data.visible;
                    applyAllFilters();
                    updateLegendUI();
                };
                const cleanName = code.replace('game:', '').replace(/-/g, ' ');
                item.innerHTML = `
                    <div class="color-box" style="background: ${data.color}"></div>
                    <div class="block-info">
                        <div class="block-name" title="${code}">${cleanName}</div>
                        <div class="block-count">x${data.count}</div>
                    </div>`;
                container.appendChild(item);
            });
        }

        window.toggleAll = (v) => { blockMetadata.forEach(m => m.visible = v); applyAllFilters(); updateLegendUI(); };
        function stringToColor(str) { let h = 0; for(let i=0; i<str.length; i++) h = str.charCodeAt(i) + ((h << 5) - h); return `hsl(${Math.abs(h)%360}, 60%, 55%)`; }
        function animate() { requestAnimationFrame(animate); if(selectedBlock) selectedBlock.material.emissiveIntensity = (Math.sin(Date.now()*0.005)+1.5)*0.5; renderer.render(scene, camera); }

        render(defaultData); 
        animate();
    </script>
</body>
</html>